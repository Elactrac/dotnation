#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo "ğŸ” Running pre-commit checks..."

# Check if contract files were modified
if git diff --cached --name-only | grep -q "^donation_platform/"; then
  echo "ğŸ“¦ Contract files modified, running tests..."
  cd donation_platform && cargo test
  if [ $? -ne 0 ]; then
    echo "âŒ Contract tests failed. Commit aborted."
    exit 1
  fi
  echo "âœ… Contract tests passed"
  cd ..
fi

# Check if frontend files were modified
if git diff --cached --name-only | grep -q "^frontend/"; then
  echo "ğŸ¨ Frontend files modified, running linter..."
  cd frontend && npm run lint
  if [ $? -ne 0 ]; then
    echo "âŒ Linting failed. Commit aborted."
    exit 1
  fi
  echo "âœ… Linting passed"
  cd ..
fi

echo "âœ… All pre-commit checks passed!"
