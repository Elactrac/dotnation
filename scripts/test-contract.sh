#!/bin/bash

# Contract Verification Test Script
# Run this to test your contract deployment on Paseo testnet

echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘      DotNation Contract Verification Test Suite           â•‘"
echo "â•‘      Paseo Testnet via Mandala Chain RPC                  â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

CONTRACT_ADDRESS="14R7BucJsVzszaZy844PTtJQPp4j9mSELjdvEktf7YZ2sT5N"
RPC_ENDPOINT="wss://rpc2.paseo.mandalachain.io"
CONTRACTS_UI_URL="https://polkadot.js.org/apps/?rpc=${RPC_ENDPOINT}#/contracts"

echo "ğŸ“‹ Contract Information:"
echo "   Address: ${CONTRACT_ADDRESS}"
echo "   Network: Paseo Testnet (Mandala Chain RPC)"
echo "   RPC:     ${RPC_ENDPOINT}"
echo ""

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "STEP 1: Manual Verification via Polkadot.js Apps UI"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "1. Open Polkadot.js Apps Contracts UI:"
echo "   ${CONTRACTS_UI_URL}"
echo ""
echo "2. Add Existing Contract:"
echo "   â€¢ Click 'Add an existing contract'"
echo "   â€¢ Contract Address: ${CONTRACT_ADDRESS}"
echo "   â€¢ Upload ABI: frontend/src/contracts/donation_platform.json"
echo "   â€¢ Click 'Save'"
echo ""
echo "3. Test Query Methods (no gas cost, instant):"
echo "   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
echo "   â”‚ Method: get_campaign_count                             â”‚"
echo "   â”‚ Expected: 0 (if no campaigns created yet)              â”‚"
echo "   â”‚ Action: Click 'Read' button                            â”‚"
echo "   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
echo ""
echo "   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
echo "   â”‚ Method: get_version                                    â”‚"
echo "   â”‚ Expected: A version number (e.g., 1 or 2)              â”‚"
echo "   â”‚ Action: Click 'Read' button                            â”‚"
echo "   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
echo ""
echo "   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
echo "   â”‚ Method: get_campaigns_paginated                        â”‚"
echo "   â”‚ Parameters: offset=0, limit=10                         â”‚"
echo "   â”‚ Expected: [] (empty array if no campaigns)             â”‚"
echo "   â”‚ Action: Click 'Read' button                            â”‚"
echo "   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
echo ""
echo "   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
echo "   â”‚ Method: get_max_batch_size                             â”‚"
echo "   â”‚ Expected: A number (probably 10 or 100)                â”‚"
echo "   â”‚ Action: Click 'Read' button                            â”‚"
echo "   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
echo ""
echo "âœ… If all queries return expected results â†’ Contract works!"
echo "âŒ If queries fail â†’ Contract may need redeployment"
echo ""

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "STEP 2: Test Campaign Creation (requires PAS tokens)"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "Prerequisites:"
echo "   â€¢ Polkadot.js extension installed"
echo "   â€¢ Account with at least 1 PAS token"
echo "   â€¢ Account connected on Paseo network"
echo ""
echo "1. In Polkadot.js Apps Contracts UI, find your contract"
echo ""
echo "2. Execute: create_campaign"
echo "   Parameters:"
echo "   â€¢ title: \"Test Campaign\""
echo "   â€¢ description: \"This is a test campaign for verification\""
echo "   â€¢ goal: 10000000000000 (10 DOT in plancks)"
echo "   â€¢ deadline: $(date -u -v+7d +%s)000 (7 days from now in milliseconds)"
echo "   â€¢ beneficiary: <your_wallet_address>"
echo ""
echo "3. Sign and submit transaction"
echo ""
echo "4. Wait for confirmation (6-12 seconds)"
echo ""
echo "5. Query get_campaign_count again:"
echo "   Expected: 1 (after first campaign)"
echo ""
echo "6. Query get_campaign(0) to see your campaign:"
echo "   Expected: Campaign object with your details"
echo ""

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "STEP 3: Test Frontend Integration"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "Terminal 1 - Start Backend:"
echo "   cd gemini-backend"
echo "   npm install"
echo "   npm start"
echo ""
echo "Terminal 2 - Start Frontend:"
echo "   cd frontend"
echo "   npm install"  
echo "   npm run dev"
echo ""
echo "Browser:"
echo "   1. Open http://localhost:5174"
echo "   2. Connect wallet (must be on Paseo network)"
echo "   3. Navigate to 'Create Campaign'"
echo "   4. Fill form and create campaign"
echo "   5. Check if campaign appears in dashboard"
echo ""
echo "Browser Console Checks:"
echo "   âœ… [CampaignContext] contract exists: true"
echo "   âœ… [ApiContext] Connected to: Paseo Testnet"
echo "   âœ… [WalletContext] Connected: <your_address>"
echo ""

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "STEP 4: Verify Results"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "Verification Checklist:"
echo "   [ ] Contract queries work in UI"
echo "   [ ] Contract responds to get_campaign_count"
echo "   [ ] Can create campaign via UI"
echo "   [ ] Campaign appears in contract storage"
echo "   [ ] Frontend can connect to contract"
echo "   [ ] Frontend can create campaigns"
echo "   [ ] Campaigns persist across page refreshes"
echo ""

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "Quick Links"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "Polkadot.js Apps (Contracts):"
echo "   ${CONTRACTS_UI_URL}"
echo ""
echo "Polkadot.js Apps (Accounts):"
echo "   https://polkadot.js.org/apps/?rpc=${RPC_ENDPOINT}#/accounts"
echo ""
echo "Polkadot.js Apps (Explorer):"
echo "   https://polkadot.js.org/apps/?rpc=${RPC_ENDPOINT}#/explorer"
echo ""
echo "Contract Address:"
echo "   ${CONTRACT_ADDRESS}"
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""

read -p "Press Enter to open Polkadot.js Apps in browser (or Ctrl+C to exit)..."

# Open browser (macOS)
if [[ "$OSTYPE" == "darwin"* ]]; then
    open "${CONTRACTS_UI_URL}"
    echo "âœ… Browser opened!"
else
    echo "Please manually open: ${CONTRACTS_UI_URL}"
fi

echo ""
echo "ğŸ“ Note: Full verification report available in:"
echo "   CONTRACT_VERIFICATION_REPORT.md"
echo ""
